{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Dashboard</h2>
  <div>
    <a class="btn btn-outline-primary me-2" href="{{ url_for('create_item') }}">+ Add Item</a>
    <form class="d-inline" action="{{ url_for('dashboard') }}" method="get">
      <select name="status" onchange="this.form.submit()" class="form-select d-inline-block" style="width:auto">
        <option value="all" {% if status_filter=='all' %}selected{% endif %}>All</option>
        <option value="lost" {% if status_filter=='lost' %}selected{% endif %}>Lost</option>
        <option value="found" {% if status_filter=='found' %}selected{% endif %}>Found</option>
      </select>
    </form>
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-8">
    <form class="d-flex" action="{{ url_for('search') }}" method="get">
      <input class="form-control me-2" type="search" name="q" placeholder="Search by title or description" value="">
      <button class="btn btn-outline-secondary">Search</button>
    </form>
  </div>
  <div class="col-md-4 text-end">
    <small class="text-muted">Signed in as <strong>{{ user.email }}</strong></small>
  </div>
</div>

<div class="row g-3">
  {% for it in items %}
    <div class="col-md-4">
      <div class="card h-100 shadow-sm">
        {% if it.image_filename %}
          <img src="{{ url_for('static', filename='uploads/' ~ it.image_filename) }}" class="card-img-top" style="height:200px;object-fit:cover">
        {% else %}
          <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height:200px">No image</div>
        {% endif %}
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ it.title }}</h5>
          <p class="card-text text-muted small mb-2">{{ it.description }}</p>
          <p class="mb-2"><span class="badge bg-info text-dark">{{ it.status|capitalize }}</span></p>
          <div class="mt-auto">
            <a href="{{ url_for('view_item', item_id=it.id) }}" class="btn btn-sm btn-primary">View</a>
            <a href="{{ url_for('edit_item', item_id=it.id) }}" class="btn btn-sm btn-outline-secondary">Edit</a>
            <form method="post" action="{{ url_for('delete_item', item_id=it.id) }}" class="d-inline" onsubmit="return confirm('Delete this item?');">
              <button class="btn btn-sm btn-danger">Delete</button>
            </form>
          </div>
        </div>
        <div class="card-footer text-muted small">
          Posted by {{ it.owner_email }} â€¢ {{ it.created_at.strftime('%Y-%m-%d') }}
        </div>
      </div>
    </div>
  {% else %}
    <div class="col-12">
      <div class="alert alert-info">No items found.</div>
    </div>
  {% endfor %}
</div>
{% endblock %}
